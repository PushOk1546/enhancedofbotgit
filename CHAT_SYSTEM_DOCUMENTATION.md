# üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤

## üéØ **–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã**

–°–∏—Å—Ç–µ–º–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (—Å–æ–∑–¥–∞—Ç–µ–ª—é –∫–æ–Ω—Ç–µ–Ω—Ç–∞) —É–ø—Ä–∞–≤–ª—è—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –¥–∏–∞–ª–æ–≥–∞–º–∏ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏, —Å–æ—Ö—Ä–∞–Ω—è—è –∏—Å—Ç–æ—Ä–∏—é, –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø–∞–º—è—Ç—å –æ –∫–∞–∂–¥–æ–º –∫–ª–∏–µ–Ω—Ç–µ.

### **–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —á–∞—Ç—ã** - —Å–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —á–∞—Ç–æ–≤
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** - –ò–ò –ø–æ–º–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –∫–∞–∂–¥–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞
- ‚úÖ **–ü–∞–º—è—Ç—å –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –∏ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤
- ‚úÖ **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —á–∞—Ç–∞–º–∏** - –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ–±—â–µ–Ω–∏—è** - —ç—Ç–∞–ø—ã –æ—Ç–Ω–æ—à–µ–Ω–∏–π, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- ‚úÖ **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã** - –ò–ò –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞

## üèó **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã**

### **1. –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

#### **`chat_models.py`** - –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
```python
ClientProfile    # –ü—Ä–æ—Ñ–∏–ª—å –∫–ª–∏–µ–Ω—Ç–∞ —Å –±–∞–∑–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
ChatMessage      # –°–æ–æ–±—â–µ–Ω–∏–µ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π
ClientChat       # –ß–∞—Ç —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–æ–º
ChatManager      # –ú–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —á–∞—Ç–∞–º–∏
```

#### **`chat_utils.py`** - –£—Ç–∏–ª–∏—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
```python
get_chat_management_keyboard()    # –ì–ª–∞–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
get_chat_list_keyboard()          # –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
format_chat_info()                # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —á–∞—Ç–µ
create_chat_context_prompt()      # –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
```

#### **`chat_handlers.py`** - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
```python
ChatHandlers.handle_chat_management()    # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
ChatHandlers.handle_new_chat()           # –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞
ChatHandlers.handle_switch_chat()        # –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–∞—Ç–æ–≤
ChatHandlers.process_chat_reply_input()  # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤
```

### **2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π:**

#### **–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ `models.py`:**
```python
UserState.chat_manager              # –ú–µ–Ω–µ–¥–∂–µ—Ä —á–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
UserState.waiting_for_chat_name     # –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–∞
UserState.waiting_for_chat_reply    # –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –≤ —á–∞—Ç–µ
```

#### **–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ `bot.py`:**
```python
BotManager.chat_handlers            # –≠–∫–∑–µ–º–ø–ª—è—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —á–∞—Ç–æ–≤
_handle_chat_management_button()    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ß–∞—Ç—ã —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏"
```

## üîÑ **–ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã**

### **1. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí "üë• –ß–∞—Ç—ã —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏" ‚Üí "‚ûï –ù–æ–≤—ã–π —á–∞—Ç" ‚Üí –í–≤–æ–¥ –∏–º–µ–Ω–∏ ‚Üí –ß–∞—Ç —Å–æ–∑–¥–∞–Ω
```

### **2. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —á–∞—Ç–∞–º–∏:**
```
"üí¨ –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤" ‚Üí –í—ã–±–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞ ‚Üí –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ ‚Üí –ö–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–≥—Ä—É–∂–µ–Ω
```

### **3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞:**
```
"üí¨ –û—Ç–≤–µ—Ç–∏—Ç—å" ‚Üí –í–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ ‚Üí –ò–ò –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç ‚Üí –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
```

### **4. –ü–∞–º—è—Ç—å –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞:**
```
"üß† –ü–∞–º—è—Ç—å –∫–ª–∏–µ–Ω—Ç–∞" ‚Üí –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π ‚Üí "üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞" ‚Üí –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```

## üìä **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö**

### **ClientProfile:**
```python
{
    "client_id": "uuid4",
    "name": "–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞",
    "description": "–û–ø–∏—Å–∞–Ω–∏–µ",
    "created_at": "2025-06-02T23:00:00",
    "last_interaction": "2025-06-02T23:30:00",
    "tags": ["VIP", "–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π"],
    "metadata": {"–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è": "–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"}
}
```

### **ChatMessage:**
```python
{
    "message_id": "uuid4",
    "role": "user|assistant|system",
    "content": "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è",
    "message_type": "text|flirt|ppv|tip_request",
    "timestamp": "2025-06-02T23:00:00",
    "metadata": {},
    "context_tags": ["—Ñ–ª–∏—Ä—Ç", "–ø–æ–∫—É–ø–∫–∞"]
}
```

### **ClientChat:**
```python
{
    "chat_id": "uuid4",
    "client_profile": ClientProfile,
    "messages": [ChatMessage, ...],
    "conversation_stage": "initial|warming_up|engaged|intimate",
    "client_mood": "happy|neutral|excited|frustrated",
    "interaction_pattern": {
        "response_time": "fast|medium|slow",
        "message_length": "short|medium|long",
        "emoji_usage": "none|light|moderate|heavy",
        "flirt_receptiveness": "unknown|low|medium|high"
    },
    "client_memory": {
        "preferences": {"–ª—é–±–∏–º—ã–π_—Ü–≤–µ—Ç": "–∫—Ä–∞—Å–Ω—ã–π"},
        "interests": ["—Ñ–∏—Ç–Ω–µ—Å", "–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è"],
        "important_dates": {"–¥–µ–Ω—å_—Ä–æ–∂–¥–µ–Ω–∏—è": "01-01"},
        "purchase_history": [...],
        "communication_notes": ["–õ—é–±–∏—Ç –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã"]
    }
}
```

## üé≠ **–≠—Ç–∞–ø—ã –æ—Ç–Ω–æ—à–µ–Ω–∏–π**

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —ç—Ç–∞–ø –æ—Ç–Ω–æ—à–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏–π:

- üå± **initial** (1-3 —Å–æ–æ–±—â–µ–Ω–∏—è) - –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ
- üî• **warming_up** (4-10 —Å–æ–æ–±—â–µ–Ω–∏–π) - –†–∞–∑–æ–≥—Ä–µ–≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–π  
- üíï **engaged** (11-20 —Å–æ–æ–±—â–µ–Ω–∏–π) - –ê–∫—Ç–∏–≤–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ
- üòç **intimate** (20+ —Å–æ–æ–±—â–µ–Ω–∏–π) - –ë–ª–∏–∑–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è

## üß† **–°–∏—Å—Ç–µ–º–∞ –ø–∞–º—è—Ç–∏**

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:**
- **–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è** - –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞
- **–ò–Ω—Ç–µ—Ä–µ—Å—ã** - –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ —Ç–µ–º–∞–º —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤
- **–ü–∞—Ç—Ç–µ—Ä–Ω—ã –æ–±—â–µ–Ω–∏—è** - –∞–Ω–∞–ª–∏–∑ —Å—Ç–∏–ª—è –∏ —á–∞—Å—Ç–æ—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
- **–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ PPV –∏ —á–∞–µ–≤—ã—Ö

### **–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é:**
```
"üß† –ü–∞–º—è—Ç—å –∫–ª–∏–µ–Ω—Ç–∞" ‚Üí "‚úèÔ∏è –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É" ‚Üí –í–≤–æ–¥ –∑–∞–º–µ—Ç–∫–∏ ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
```

## üí¨ **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã**

–°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –ò–ò, –≤–∫–ª—é—á–∞—é—â–∏–µ:

```python
def create_chat_context_prompt(chat, user_message):
    return f"""
    –¢—ã –æ–±—â–∞–µ—à—å—Å—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º {chat.client_profile.name}.
    
    –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏–π:
    - –≠—Ç–∞–ø: {chat.conversation_stage}
    - –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞: {chat.client_mood}
    - –í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π: {len(chat.messages)}
    
    –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞: {chat.client_memory["preferences"]}
    –ò–Ω—Ç–µ—Ä–µ—Å—ã: {chat.client_memory["interests"]}
    
    –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è: {recent_messages}
    
    –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: {user_message}
    
    –°–æ–∑–¥–∞–π –æ—Ç–≤–µ—Ç, —É—á–∏—Ç—ã–≤–∞—è –≤—Å—é —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.
    """
```

## üé® **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**

### **–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —á–∞—Ç–æ–≤:**
```
üí¨ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏

üìä –í—Å–µ–≥–æ —á–∞—Ç–æ–≤: 5
üü¢ –ê–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç: –ê–ª–µ–∫—Å–µ–π
üíå –°–æ–æ–±—â–µ–Ω–∏–π: 15
üé≠ –≠—Ç–∞–ø: engaged

[üí¨ –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤] [‚ûï –ù–æ–≤—ã–π —á–∞—Ç]
[üìù –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å] [üóë –£–¥–∞–ª–∏—Ç—å —á–∞—Ç]
[üß† –ü–∞–º—è—Ç—å –∫–ª–∏–µ–Ω—Ç–∞] [üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞]
[üîô –ù–∞–∑–∞–¥]
```

### **–°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤:**
```
üí¨ –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ (—Å—Ç—Ä. 1)

1. üü¢ üíï –ê–ª–µ–∫—Å–µ–π
   üíå 15 —Å–æ–æ–±—â–µ–Ω–∏–π
   üìù –ö–∞–∫ –¥–µ–ª–∞, –∫—Ä–∞—Å–∞–≤–∏—Ü–∞?...

2. ‚ö™ üî• –ú–∞—Ä–∏—è
   üíå 8 —Å–æ–æ–±—â–µ–Ω–∏–π  
   üìù –°–ø–∞—Å–∏–±–æ –∑–∞ —Ñ–æ—Ç–æ...

[‚¨ÖÔ∏è] [üìÑ 1/2] [‚û°Ô∏è]
[‚ûï –ù–æ–≤—ã–π —á–∞—Ç] [üîô –ù–∞–∑–∞–¥]
```

### **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —á–∞—Ç–∞:**
```
üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ —á–∞—Ç —Å –ê–ª–µ–∫—Å–µ–π

üí¨ –ê–ª–µ–∫—Å–µ–π
üî• –≠—Ç–∞–ø: warming_up
üíå –°–æ–æ–±—â–µ–Ω–∏–π: 8
üïí –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: 2 —á. –Ω–∞–∑–∞–¥

üìù –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –ø—Ä–æ—à–µ–ª —Ç–≤–æ–π –¥–µ–Ω—å?

[üí¨ –û—Ç–≤–µ—Ç–∏—Ç—å] [üíù –§–ª–∏—Ä—Ç]
[üéÅ PPV] [üí∞ –ß–∞–µ–≤—ã–µ]
[üìù –ó–∞–º–µ—Ç–∫–∞] [üè∑ –¢–µ–≥–∏]
[üîÑ –°–º–µ–Ω–∏—Ç—å —á–∞—Ç] [‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ]
```

## üìà **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞**

### **–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
```
üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —á–∞—Ç–æ–≤

üìà –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
‚Ä¢ –í—Å–µ–≥–æ —á–∞—Ç–æ–≤: 5
‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã–µ —á–∞—Ç—ã: 4
‚Ä¢ –í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π: 127
‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ —á–∞—Ç: 25

üé≠ –ü–æ —ç—Ç–∞–ø–∞–º –æ—Ç–Ω–æ—à–µ–Ω–∏–π:
‚Ä¢ üå± initial: 1 —á–∞—Ç–æ–≤
‚Ä¢ üî• warming_up: 2 —á–∞—Ç–æ–≤  
‚Ä¢ üíï engaged: 1 —á–∞—Ç–æ–≤
‚Ä¢ üòç intimate: 1 —á–∞—Ç–æ–≤

üî• –°–∞–º—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —á–∞—Ç—ã:
1. –ê–ª–µ–∫—Å–µ–π: 45 —Å–æ–æ–±—â–µ–Ω–∏–π
2. –ú–∞—Ä–∏—è: 32 —Å–æ–æ–±—â–µ–Ω–∏—è
3. –î–º–∏—Ç—Ä–∏–π: 28 —Å–æ–æ–±—â–µ–Ω–∏–π
```

## üîß **API –∏ –º–µ—Ç–æ–¥—ã**

### **ChatManager –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
```python
# –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞
chat = manager.create_chat("–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞", "–û–ø–∏—Å–∞–Ω–∏–µ")

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–∞—Ç–∞
success = manager.switch_chat(chat_id)

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —á–∞—Ç–∞
active_chat = manager.get_active_chat()

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
manager.add_message_to_active_chat("user", "–ü—Ä–∏–≤–µ—Ç!", "text")

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ò–ò
context = manager.get_context_for_ai()
```

### **ClientChat –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
```python
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
chat.add_message(ChatMessage("user", "–ü—Ä–∏–≤–µ—Ç!", "text"))

# –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
recent = chat.get_recent_messages(5)

# –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –ò–ò
summary = chat.get_context_summary()
```

## üîÑ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏**

### **–§–ª–∏—Ä—Ç —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º:**
```python
# –í–º–µ—Å—Ç–æ –æ–±—â–µ–≥–æ —Ñ–ª–∏—Ä—Ç–∞
prompt = "–°–æ–∑–¥–∞–π —Ñ–ª–∏—Ä—Ç—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"

# –¢–µ–ø–µ—Ä—å —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∫–ª–∏–µ–Ω—Ç–∞
prompt = create_chat_context_prompt(active_chat, "")
prompt += "\n–°–æ–∑–¥–∞–π —Ñ–ª–∏—Ä—Ç—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å—Ç–∏–ª–µ {style}"
```

### **PPV —Å —É—á–µ—Ç–æ–º –∏—Å—Ç–æ—Ä–∏–∏:**
```python
# –£—á–∏—Ç—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∫—É–ø–æ–∫ –∫–ª–∏–µ–Ω—Ç–∞
purchase_history = active_chat.client_memory["purchase_history"]
prompt += f"–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫: {purchase_history}"
```

## üíæ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞**

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:**
- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —á–∞—Ç–æ–≤
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞–º—è—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞
- –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –±–æ—Ç–∞

### **–§–æ—Ä–º–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:**
```json
{
  "user_id": 12345,
  "chat_manager": {
    "user_id": 12345,
    "chats": {
      "chat_uuid": { "–ø–æ–ª–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ_—á–∞—Ç–∞" }
    },
    "active_chat_id": "chat_uuid",
    "created_at": "2025-06-02T23:00:00"
  }
}
```

## üöÄ **–ö–æ–º–∞–Ω–¥—ã –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**

### **–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:**
- `üë• –ß–∞—Ç—ã —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏` - –û—Ç–∫—Ä—ã—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏
- `üí¨ –û—Ç–≤–µ—Ç–∏—Ç—å` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –≤ –∞–∫—Ç–∏–≤–Ω–æ–º —á–∞—Ç–µ
- `üß† –ü–∞–º—è—Ç—å –∫–ª–∏–µ–Ω—Ç–∞` - –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- `üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º —á–∞—Ç–∞–º

### **Workflow —Å–æ–∑–¥–∞—Ç–µ–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞:**
1. **–°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞** –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
2. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** –º–µ–∂–¥—É –∞–∫—Ç–∏–≤–Ω—ã–º–∏ —á–∞—Ç–∞–º–∏
3. **–í–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è** –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
4. **–ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞** —Å —É—á–µ—Ç–æ–º –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏
5. **–ü—Ä–æ—Å–º–æ—Ç—Ä –ø–∞–º—è—Ç–∏** –æ –∫–ª–∏–µ–Ω—Ç–µ
6. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫** –∏ —Ç–µ–≥–æ–≤

## üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç**

### **–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
- ‚úÖ **–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ** - –∫–∞–∂–¥—ã–π –∫–ª–∏–µ–Ω—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —á–∞—Ç–µ
- ‚úÖ **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã** - –ò–ò –ø–æ–º–Ω–∏—Ç –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –æ–±—â–µ–Ω–∏—è
- ‚úÖ **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** - —É—á–µ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- ‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - –±—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —á–∞—Ç–∞–º–∏
- ‚úÖ **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - –ø–æ–Ω–∏–º–∞–Ω–∏–µ –¥–∏–Ω–∞–º–∏–∫–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π

### **–î–ª—è –ò–ò:**
- ‚úÖ **–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç** - –∏—Å—Ç–æ—Ä–∏—è, –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è, —ç—Ç–∞–ø –æ—Ç–Ω–æ—à–µ–Ω–∏–π
- ‚úÖ **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã** - –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- ‚úÖ **–ü–∞–º—è—Ç—å –æ –¥–µ—Ç–∞–ª—è—Ö** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- ‚úÖ **–≠–≤–æ–ª—é—Ü–∏—è –æ–±—â–µ–Ω–∏—è** - –∞–¥–∞–ø—Ç–∞—Ü–∏—è —Å—Ç–∏–ª—è –ø–æ–¥ —ç—Ç–∞–ø –æ—Ç–Ω–æ—à–µ–Ω–∏–π

---

**üéâ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!** –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞. 